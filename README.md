# 🎮 Game Daily Quest Bot (Telegram)

Telegram에서 여러 게임의 **일일/주간 숙제**를 체크하고, **이벤트 진행 상황**까지 추적할 수 있는 유저 맞춤형 **게임 숙제 관리 봇**입니다!

---

## ✅ 주요 기능

### 📅 일일 / 주간 숙제 관리
- `/daily` : 오늘의 숙제 체크리스트 표시 (✅ 버튼 클릭으로 체크)
- `/weekly` : 이번 주의 주간 숙제 리스트 표시
- `/complete [게임명] [weekly(optional)]` : 해당 게임의 숙제를 일괄 완료 처리
- `/done` : 오늘 숙제를 모두 완료하면 `🔥 Day N 클리어` 처리
- `/progress` : 오늘의 숙제 진행률 확인
- ✅ `이벤트에 포함된 daily 숙제도 /done에 포함`

---

### 🎉 이벤트 숙제 관리
- `/addevent` : 대화형 이벤트 추가 (게임명, 이름, 종료일, 숙제, 타입)
- `/event` : 현재 진행 중인 이벤트 목록 + 숙제 체크
- `/delevent` : 이벤트 삭제 (대화형)
- `/editevent` : 이벤트 숙제 이름 수정 (대화형)

---

### ➕ 숙제 항목 관리
- `/addtask` : 게임별 숙제 항목 추가 (대화형)
- `/deltask` : 게임별 숙제 항목 삭제 (대화형)
- `/renamegame` : 게임 이름 변경
- `/editquest` : 숙제 이름 수정 (daily/weekly 대상)
- `/listtasks` : 등록된 모든 게임 숙제 및 이벤트 목록 출력 (📅 D-Day 기준 정렬 포함)

---

### 📂 데이터 업로드
- `/importquests` : `quests.json` 파일을 텔레그램에 첨부하여 덮어쓰기 가능

---

### ℹ️ 기타 명령어
- `/start` : 봇 인사 + 게임 목록 안내
- `/help` : 전체 명령어 도움말 출력
- `/test` : 숙제 알림 테스트 (직접 확인용)

---

## 🕐 자동 스케줄러 기능

| 작업 내용                | 시간 (KST 기준)            |
|-------------------------|-----------------------------|
| 숙제 초기화 (일일)      | 매일 오전 5시               |
| 숙제 초기화 (주간)      | 매주 월요일 오전 5시        |
| 알림 메시지 전송        | 매일 오전 8시               |
| 이벤트 숙제 반영 / 정리 | 매일 오전 5시               |
| 이벤트 D-1 마감 알림    | 매일 오전 8시               |
| 슬립 방지 ping          | 10분 간격 (`SELF_URL` 필요) |
| 데이터 백업             | 매일 오전 5시 (`.bak` 생성) |

---

## ⚙️ 환경 변수 설정

| 환경 변수           | 설명                                      |
|---------------------|---------------------------------------------|
| `TELEGRAM_BOT_TOKEN` | 텔레그램 봇 토큰 (필수)                   |
| `SELF_URL`           | Fly.io 배포 주소 (슬립 방지용, 선택사항)  |

---

## 💾 데이터 파일 구조

| 파일 경로               | 설명                                           |
|--------------------------|------------------------------------------------|
| `/data/quests.json`      | 게임, 숙제, 이벤트 정보 (자동 관리)           |
| `/data/checklist.json`   | 유저 숙제 체크 기록 (자동 저장)               |
| `/data/users.json`       | 유저 진행도 및 Day streak 저장                |
| `/data/*.bak`            | 각 파일의 롤링 백업본 (`YYYYMMDD_HHMM.bak`) |

> 💡 Fly.io 또는 Railway 사용 시 `/data/` 폴더는 **볼륨(Volume)** 으로 설정해 **데이터 유실을 방지**하세요.

---

## 🚀 실행 방법

```bash
# 의존성 설치
pip install -r requirements.txt

# 실행
python bot.py
```

---

## 💡 사용 팁

- **하루에 하나의 인스턴스만 실행**해야 텔레그램 API 충돌을 피할 수 있습니다.
- `checklist.json`, `users.json`, `quests.json`은 자동으로 백업되며 `.bak` 확장자로 생성됩니다.
- JSON 데이터가 손상되었을 경우, 자동 복원이 시도됩니다. 필요 시 수동으로 `.bak` 파일을 복원하세요.
- Fly.io에 배포하는 경우 `fly.toml`에 볼륨을 지정하거나, Railway에서 영속 스토리지를 활성화하세요.

---

## 📮 피드백 / 개선 제안

Pull request 및 issue는 언제든 환영입니다!